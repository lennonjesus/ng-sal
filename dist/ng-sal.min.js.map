{"version":3,"sources":["main.js","authenticated-application.directive.js","constant.config.js","login-panel.directive.js","login.controller.js","login.service.js","permission.service.js","user-panel.directive.js","user.controller.js"],"names":["angular","module","authenticatedApplication","loginService","$document","$location","permissionService","restrict","link","scope","elem","attrs","isAuthenticated","getCurrentUser","username","authenticate","data","setUserDetails","removeClass","$on","hasPermission","resource","directive","$inject","constant","applicationName","applicationHomePath","applicationApiVersion","name","loginPanel","ngsalConfig","template","apiVersion","loginController","$scope","authService","$sanitize","sanitizeCredentials","password","btoa","unescape","encodeURIComponent","ignoreAuthModule","limpaForm","authenticationError","submit","login","activateLogin","logout","controller","$resource","$rootScope","service","method","isArray","headers","Content-Type","logoutApi","url","user","goToPerfil","params","codigo","currentUser","obj","permissions","userDetails","loginConfirmed","loginCancelled","success","$broadcast","factory","secureResource","userPanel","userController","$state","changePerfil","perfil","go","homePath"],"mappings":"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","file":"ng-sal.min.js","sourcesContent":["(function () {\r\n  'use strict';\r\n\r\n  angular.module('ng-sal', ['http-auth-interceptor', 'ui.router']);\r\n\r\n})();\r\n","(function () {\r\n  'use strict';\r\n\r\n  angular.module('ng-sal').directive('authenticatedApplication', authenticatedApplication);\r\n\r\n  authenticatedApplication.$inject = ['loginService', '$document', '$location', 'permissionService'];\r\n\r\n  function authenticatedApplication (loginService, $document, $location, permissionService) {\r\n      return {\r\n          restrict: 'A',\r\n          link: function (scope, elem, attrs) {\r\n\r\n              scope.isAuthenticated = false;\r\n\r\n              if (loginService.getCurrentUser() === null || loginService.getCurrentUser().username === null || loginService.getCurrentUser().username === '') {\r\n                  loginService.authenticate({}, function (data) {\r\n                      scope.isAuthenticated = true;\r\n                      loginService.setUserDetails(data);\r\n                  }, function (data) {\r\n                      scope.isAuthenticated = false;\r\n                  });\r\n              }\r\n              elem.removeClass('waiting-for-angular');\r\n\r\n              scope.$on('event:auth-loginRequired', function () {\r\n                  scope.isAuthenticated = false;\r\n              });\r\n              scope.$on('event:auth-loginConfirmed', function () {\r\n                  scope.isAuthenticated = true;\r\n              });\r\n              scope.$on('event:userLogout', function () {\r\n                  scope.isAuthenticated = false;\r\n              });\r\n              scope.hasPermission = function(resource){\r\n                  return permissionService.hasPermission(resource);\r\n              };\r\n          }\r\n      };\r\n  }\r\n\r\n})();\r\n","(function () {\r\n  'use strict';\r\n\r\n  angular.module('ng-sal').constant('ngsalConfig', {\r\n      applicationName: 'ngsalConfig.applicationName',\r\n      applicationHomePath : 'ngsalConfig.homePath',\r\n      applicationApiVersion: 'ngsalConfig.apiVersion'\r\n  }).constant('secureResource', {\r\n      name: function (name){\r\n          return 'ROLE_' + name;\r\n      }\r\n  });\r\n})();\r\n","(function () {\r\n  'use strict';\r\n\r\n  angular.module('ng-sal').directive('loginPanel', loginPanel);\r\n\r\n  loginPanel.$inject = ['ngsalConfig'];\r\n\r\n  function loginPanel (ngsalConfig) {\r\n      return {\r\n          restrict: 'A',\r\n          template: '<div block-ui block-ui-pattern=\"/.*\\/api\\/' + ngsalConfig.apiVersion + '\\/authentication/\"><div class=\"content-field-total\" ng-controller=\"loginController\" ng-hide=\"isAuthenticated\"><div class=\"content-field\"><h3>Área Restrita</h3><div class=\"alarm alarm-alizarin\" ng-show=\"authenticationError\">Usuário ou senha inválido!</div><div id=\"login-box\"><form name=\"loginForm\" autocomplete=\"off\"><div class=\"content-login\" show-errors><label>Login</label><input auto-focus type=\"text\" name=\"username\" ng-model=\"username\"/><div class=\"alarm alarm-alizarin\" ng-show=\"loginForm.username.$error.required\">Obrigatório</div></div><div class=\"content-pass\" show-errors><label>Senha</label><input type=\"password\" name=\"password\" ng-model=\"password\" /><div class=\"alarm alarm-alizarin\" ng-show=\"loginForm.password.$error.required\">Obrigatório</div></div><div class=\"content-buttons\"><button class=\"bt bt-lime\" type=\"submit\" ng-click=\"submit()\" ><i class=\"mdi mdi-check\"></i>Autenticar</button></div></form></div></div></div>'\r\n      }\r\n  }\r\n\r\n})();\r\n","(function () {\r\n  'use strict';\r\n\r\n  angular.module('ng-sal').controller('loginController', loginController);\r\n\r\n  loginController.$inject = ['$scope', 'loginService', 'authService', '$document', '$sanitize'];\r\n\r\n  function loginController ($scope, loginService, authService, $document, $sanitize) {\r\n\r\n      $scope.authenticationError = false;\r\n\r\n      function sanitizeCredentials() {\r\n          return {\r\n              username: $sanitize($scope.username),\r\n              password: btoa(unescape(encodeURIComponent($scope.password))),\r\n              ignoreAuthModule: 'ignoreAuthModule'\r\n          };\r\n      }\r\n\r\n      $scope.submit = function () {\r\n\r\n          $scope.authenticationError = false;\r\n\r\n          loginService.login(sanitizeCredentials(),\r\n              function (data) {\r\n                  loginService.activateLogin(data);\r\n                  limpaForm();\r\n              }, function (data) {\r\n                  loginService.logout(data);\r\n                  limpaForm();\r\n                  $scope.authenticationError = true;\r\n              });\r\n      };\r\n\r\n      function limpaForm() {\r\n          $scope.username = null;\r\n          $scope.password = null;\r\n\r\n      }\r\n\r\n  }\r\n\r\n})();\r\n","(function () {\r\n  'use strict';\r\n\r\n  angular.module('ng-sal').factory('loginService', loginService);\r\n\r\n  loginService.$inject = ['$resource', 'authService', '$rootScope', 'ngsalConfig'];\r\n\r\n  function loginService ($resource, authService, $rootScope, ngsalConfig) {\r\n      var service = $resource('/' + ngsalConfig.applicationName + '/api/' + ngsalConfig.apiVersion + '/authentication', {\r\n          'username': '@username',\r\n          'password': '@password'\r\n      }, {\r\n          'login': {\r\n              method: 'POST',\r\n              isArray: false,\r\n              headers: {'Content-Type': 'application/x-www-form-urlencoded'},\r\n              ignoreAuthModule: 'ignoreAuthModule'\r\n          },\r\n          'logoutApi': {\r\n              method: 'GET',\r\n              url: '/' + ngsalConfig.applicationName + '/api/' + ngsalConfig.apiVersion + '/logout',\r\n              isArray: true,\r\n              ignoreAuthModule: 'ignoreAuthModule'\r\n          },\r\n          'authenticate': {\r\n              method: 'GET',\r\n              url: '/' + ngsalConfig.applicationName + '/api/' + ngsalConfig.apiVersion + '/authenticate',\r\n              isArray: false,\r\n              ignoreAuthModule: 'ignoreAuthModule'\r\n          },\r\n          'user': {\r\n              method: 'GET',\r\n              url: '/' + ngsalConfig.applicationName + '/api/' + ngsalConfig.apiVersion + '/user',\r\n              isArray: false\r\n          },\r\n          'goToPerfil': {\r\n              method: 'GET',\r\n              url: '/' + ngsalConfig.applicationName + '/api/' + ngsalConfig.apiVersion + '/goToPerfil/:codigo',\r\n              params: {codigo: '@codigo'},\r\n              isArray: false\r\n          }\r\n      });\r\n\r\n      var currentUser = null;\r\n\r\n      service.getCurrentUser = function () {\r\n          return currentUser;\r\n      };\r\n\r\n      service.activateLogin = function (obj) {\r\n          currentUser = {username: obj.username, permissions: {}, userDetails: {}};\r\n          service.authenticate({}, function (userDetails) {\r\n              service.setUserDetails(userDetails);\r\n              authService.loginConfirmed(obj);\r\n          });\r\n\r\n      };\r\n\r\n      service.logout = function (data) {\r\n          authService.loginCancelled(data);\r\n          currentUser = null;\r\n          service.logoutApi(function (success) {\r\n              $rootScope.$broadcast('event:userLogout');\r\n          });\r\n\r\n      };\r\n\r\n      service.setUserDetails = function (data) {\r\n          if (!currentUser) currentUser = {username: data.username, permissions: {}, userDetails: {}};\r\n          currentUser.userDetails = data.userDetails;\r\n          currentUser.permissions = data.permissions;\r\n          $rootScope.currentUser = currentUser;\r\n          $rootScope.$broadcast('event:userDetailsPrepared');\r\n      };\r\n\r\n      return service;\r\n  }\r\n\r\n})();\r\n","(function () {\r\n  'use strict';\r\n\r\n  angular.module('ng-sal').factory('permissionService', permissionService);\r\n\r\n  permissionService.$inject = ['loginService','secureResource'];\r\n\r\n  function permissionService (loginService,secureResource) {\r\n\r\n    var service = {\r\n        hasPermission : hasPermission\r\n    };\r\n\r\n    return service;\r\n\r\n    function hasPermission(name){\r\n         if(loginService.getCurrentUser()){\r\n            return loginService.getCurrentUser().permissions[secureResource.name(name)];\r\n         }\r\n         return false;\r\n    }\r\n\r\n  }\r\n\r\n})();\r\n","(function () {\r\n  'use strict';\r\n\r\n  angular.module('ng-sal').directive('userPanel', userPanel);\r\n\r\n  function userPanel () {\r\n      return {\r\n          restrict: 'A',\r\n          template:\r\n          '<div class=\"navbar-right\" ng-controller=\"userController\" ng-show=\"isAuthenticated\">' +\r\n              '<ul class=\"nav navbar-nav\">' +\r\n                  '<li class=\"dropdown user user-menu\">' +\r\n                      '<a href=\"\" class=\"dropdown-toggle\" data-toggle=\"dropdown\"> <i class=\"glyphicon glyphicon-user\"></i></a>' +\r\n                      '<ul class=\"dropdown-menu\">' +\r\n                          '<li class=\"user-header bg-light-blue\"  style=\"height: auto;\"><p><small>{{user.login}}</small></p><p>{{user.nome}}<small>Perfil: {{user.perfil}}</small></p></li>' +\r\n                          '<li class=\"user-footer\"><div class=\"pull-right\"><a href=\"\" ng-click=\"logout()\" class=\"btn btn-danger\" style=\"color:white;\"> Sair</a></div></li>' +\r\n                      '</ul>' +\r\n                  '</li>' +\r\n              '</ul>' +\r\n          '</div>'\r\n      }\r\n  }\r\n\r\n})();\r\n","(function () {\r\n  'use strict';\r\n\r\n  angular.module('ng-sal').controller('userController', userController);\r\n\r\n  userController.$inject = ['$scope', 'loginService', 'ngsalConfig', '$state'];\r\n\r\n  function userController ($scope, loginService,ngsalConfig, $state) {\r\n\r\n      $scope.logout = function () {\r\n          loginService.logout();\r\n      };\r\n\r\n      $scope.changePerfil = function (perfil) {\r\n          //TODO: depende de alteração do sca\r\n      };\r\n\r\n      $scope.$on('event:userDetailsPrepared', function () {\r\n          $scope.user = loginService.getCurrentUser().userDetails;\r\n          $state.go(ngsalConfig.homePath);\r\n      });\r\n\r\n      $scope.$on('event:userLogout', function () {\r\n          $scope.user = {};\r\n      });\r\n\r\n  }\r\n\r\n})();\r\n"]}